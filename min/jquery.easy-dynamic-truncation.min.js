/* (c) Aaron Gustafson (@AaronGustafson). MIT License. http://github.com/easy-designs/jquery.easy-dynamic-truncation.js */
(function(z,J,c,B){var L=false,y=null,M="More",K="All",e="hide",b="reveal",t=".",a=" ",k="a",w="[data-",f="]",j=":not(",n=")",h="click",m="truncate",I=m+"-reveal",e=m+"-hide",o=m+"-collapsed",C=m+"-max-items",q=w+C+f,u=m+"-char-limit",F=m+"-auto-display",E=m+"-exclude",H=t+E,l="more-link",i=t+l,v=z(q),g=z('<div class="'+l+'"><a class="'+I+'" href="#show-more">More</a></div>'),r='<b class="'+m+'-string">',s="</b>",G=z('<i class="'+m+'-ellipsis">\u2026</i>'),D=t+m+"-ellipsis",x=z(J),d=0;if("ontouchstart" in J||"createTouch" in c){h="touchend"}function p(O){var N;O.size=d;function A(){var P=x.width();clearTimeout(N);N=y;if(O.size!=P){O();O.size=P}}x.resize(function(){if(N){clearTimeout(N);N=y}N=setTimeout(A,50)});O()}p(function(){d=x.width()});v.each(function(){var S=z(this),Z=S.data(C),N=S.data(E),Y=S.data(F),ac=S.is(w+m+"-collapsible]"),ad=S.is(w+m+"-no-more]"),O=L,P=0,Q=z([]),A=S.is(w+m+"-embed]"),W=S.siblings(i),R=(W.length>0),X,V=(N!=B?S.children(j+N+n):S.children()).filter(j+i+n);if(S.is(w+u+f)){O=parseInt(S.data(u),10);V.each(function(){var ag=z(this),ai=ag.text(),ae=ag.html(),ah=ai.split(a),af=ai.length;ag.addClass(E);if((P+af)>O){z.each(ah,function(ak,am){var al=am.length+1,aj;if(P+al>O){aj=ah[ak-2]+a+ah[ak-1]+a;ag.html(ae.replace(aj,aj+r)+s);return L}P+=al});return L}P+=af});V=V.filter(j+H+n);Q=S.find(t+m+"-string")}else{if(Z!=B){V=V.eq(Z-1).nextAll()}}function U(ae){if(S.state==b){return}V.add(Q).removeClass(o);if(ad){var af=V.eq(0).prev();if(af.length<1){af=Q.closest(H)}af.find(D).remove()}else{ab(ae,b)}S.state=b}function T(ae){if(S.state==e){return}V.add(Q).addClass(o);if(ad){var af=V.eq(0).prev();if(af.length<1){af=Q.closest(H)}af.append(G.clone())}else{ab(ae,e)}S.state=e}function aa(af){var ae=z(this);if(ae.is(t+I)){U(ae)}else{T(ae)}af.preventDefault()}function ab(ae,ag){ag=ag||e;var af=V.eq(0).prev(),ah;if(ag==e){if(af.length<1){af=Q.closest(H)}if(!Y&&V.length){if(ae!=B){ae.text(M).addClass(I).removeClass(e);if(A){af.append(W.prepend(G.clone()))}}else{if(!R){W=g.clone();if(A){W=W.find("a").wrap('<span class="'+l+'"/>').parent().prepend(G.clone());af.append(W)}else{S.closest(":not(ol,ul,dl)").append(W)}}else{ae=W.find("a").addClass(I);ae.html(ae.html().replace(K,M))}}W.on(h,k,aa)}}else{if(ag==b&&ae){ae.removeClass(I);if(ac){ae.text("Less").addClass(e);if(A){V.last().append(W);W.find(D).remove()}}else{if(!R){ah=ae.parent();if(ah.is(i)){ah.remove()}else{ae.remove()}}else{ae.html(ae.html().replace(M,K));W.off(h,k,aa)}}}}}p(function(){var ae=Y;if(ae!=B){ae=d>=ae;(ae?U:T)()}else{T()}})})})(jQuery,window,document);