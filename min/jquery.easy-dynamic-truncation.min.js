/* (c) Aaron Gustafson (@AaronGustafson). MIT License. http://github.com/easy-designs/jquery.easy-dynamic-truncation.js */
(function(B,K,d,C){var M=false,y=null,N="More",L="All",f="hide",b="reveal",t=".",a=" ",l="a",w="[data-",g="]",k=":not(",o=")",i="click",n="truncate",J=n+"-reveal",f=n+"-hide",p=n+"-collapsed",D=n+"-max-items",u=n+"-char-limit",G=n+"-auto-display",F=n+"-exclude",I=t+F,m="more-link",j=t+m,v=B([x(D),x(u)].join(",")),h=B('<div class="'+m+'"><a class="'+J+'" href="#show-more">More</a></div>'),r='<b class="'+n+'-string">',s="</b>",H=B('<i class="'+n+'-ellipsis">\u2026</i>'),E=t+n+"-ellipsis",z=B(K),e=0;if("ontouchstart" in K||"createTouch" in d){i="touchend"}function q(P){var O;P.size=e;function A(){var Q=z.width();clearTimeout(O);O=y;if(P.size!=Q){P();P.size=Q}}z.resize(function(){if(O){clearTimeout(O);O=y}O=setTimeout(A,50)});P()}q(function(){e=z.width()});function x(A){return w+A+g}function c(O,A){return(A!=C?O.children(k+A+o):O.children()).filter(k+j+o)}v.each(function(){var T=B(this),ac=T.data(D),O=T.data(F),aa=T.data(G),ae=T.is(x(n+"-collapsible")),af=T.is(x(n+"-no-more")),P=M,Q=0,R=B([]),Z=false,A=T.is(x(n+"-embed")),X=T.siblings(j),S=(X.length>0),Y,W=c(T,O);if(T.is(x(u))){P=parseInt(T.data(u),10);if(!W.length){Z=true;T.contents().wrap('<b class="temp"/>');W=T.children()}W.each(function(){var ai=B(this),ak=ai.text(),ag=ai.html(),aj=ak.split(a),ah=ak.length;ai.addClass(F);if((Q+ah)>P){B.each(aj,function(am,ao){var an=ao.length+1,al;if(Q+an>P){al="";if(aj[am-1]){al=aj[am-1]+a}if(aj[am-2]){al=aj[am-2]+a+al}ai.html(ag.replace(al,al+r)+s);return M}Q+=an});return M}Q+=ah});if(Z){T.find(".temp").contents().unwrap();W=c(T,O)}W=W.filter(k+I+o);R=T.find(t+n+"-string")}else{if(ac!=C){W=W.eq(ac-1).nextAll()}}function V(ag){if(T.state==b){return}W.add(R).removeClass(p);if(af){var ah=W.eq(0).prev();if(ah.length<1){ah=R.closest(I)}ah.find(E).remove()}else{ad(ag,b)}T.state=b}function U(ag){if(T.state==f){return}W.add(R).addClass(p);if(af){var ah=W.eq(0).prev();if(ah.length<1){ah=R.closest(I)}ah.append(H.clone())}else{ad(ag,f)}T.state=f}function ab(ah){var ag=B(this);if(ag.is(t+J)){V(ag)}else{U(ag)}ah.preventDefault()}function ad(ag,ai){ai=ai||f;var ah=W.eq(0).prev(),aj;if(ai==f){if(ah.length<1){ah=R.closest(I)}if(ah.length<1){ah=T}if(!aa&&W.length){if(ag!=C){ag.text(N).addClass(J).removeClass(f);if(A){ah.append(X.prepend(H.clone()))}}else{if(!S){X=h.clone();if(A){X=X.find("a").wrap('<span class="'+m+'"/>').parent().prepend(H.clone());ah.append(X)}else{T.closest(":not(ol,ul,dl)").append(X)}}else{ag=X.find("a").addClass(J);ag.html(ag.html().replace(L,N))}}X.on(i,l,ab)}}else{if(ai==b&&ag){ag.removeClass(J);if(ae){ag.text("Less").addClass(f);if(A){W.last().append(X);X.find(E).remove()}}else{if(!S){aj=ag.parent();if(aj.is(j)){aj.remove()}else{ag.remove()}}else{ag.html(ag.html().replace(N,L));X.off(i,l,ab)}}}}}q(function(){var ag=aa;if(ag!=C){ag=e>=ag;(ag?V:U)()}else{U()}})})})(jQuery,window,document);